
<!doctype html>
<html>
  <head>
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">


    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Rhombus API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#rhombus-api-reference" class="toc-h1 toc-link" data-title="Rhombus API Reference">Rhombus API Reference</a>
          </li>
          <li>
            <a href="#activation-methods" class="toc-h1 toc-link" data-title="Activation Methods">Activation Methods</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#periodic-oracles" class="toc-h2 toc-link" data-title="Periodic oracles">Periodic oracles</a>
                  </li>
                  <li>
                    <a href="#asynchronous-oracles" class="toc-h2 toc-link" data-title="Asynchronous oracles">Asynchronous oracles</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#reply-methods" class="toc-h1 toc-link" data-title="Reply Methods">Reply Methods</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#lighthouse-contract" class="toc-h2 toc-link" data-title="Lighthouse contract">Lighthouse contract</a>
                  </li>
                  <li>
                    <a href="#direct-delivery" class="toc-h2 toc-link" data-title="Direct delivery">Direct delivery</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#getting-started" class="toc-h1 toc-link" data-title="Getting Started">Getting Started</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#direct-delivery-2" class="toc-h2 toc-link" data-title="Direct Delivery">Direct Delivery</a>
                  </li>
                  <li>
                    <a href="#lighthouse-delivery" class="toc-h2 toc-link" data-title="Lighthouse Delivery">Lighthouse Delivery</a>
                  </li>
              </ul>
          </li>
      </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='rhombus-api-reference'>Rhombus API Reference</h1>
<p>Rhombus divides oracles into two broad buckets: how the oracle is activated and
how the oracle replies. Our API for running oracles has predictable,
resource-oriented functions.</p>
<h1 id='activation-methods'>Activation Methods</h1><h2 id='periodic-oracles'>Periodic oracles</h2>
<p>When a contract needs regularly updated information, a periodic Rhombus oracle
is often the best solution. The oracle checks the data sources at regular
intervals and updates the on-chain information whenever significant changes to
that information have occurred.</p>

<aside class="example">
<span class="aside-type">Example</span>
<h3>
Periodic gold prices for an exchange contract selling gold backed
tokens.
</h3>

<p>
Every 5 minutes a Rhombus Oracle aggregates several gold price suppliers and
returns the median price to an exchange contract. If there is an anomaly in
the prices recovered, the exchange is informed of that fact so that it may
stop trading if necessary.
</p>

</aside>

<aside class="notice">
  The user could save even more gas costs by requesting that the reply is only
  sent when a certain price variation occurs, e.g. more than 1%.
</aside>
<h2 id='asynchronous-oracles'>Asynchronous oracles</h2>
<p>A contract may require information on an ad-hoc basis. A client would initiate
these requests from their smart contract. A request may contain a number of
parameters but should also contain a Unique ID (UID) tied to their oracle.
Additionally, a nonce may be supplied to ensure that replies match requests.</p>

<aside class="example">
<span class="aside-type">Example</span>
<h3>Resolving a Prediction Market</h3>

<p>
At some day and time in the future, a prediction market will want to settle
the outstanding bets for a given proposition, like gas price. When the time
comes, it mines an event that activates a Rhombus Oracle which delivers the
current gas price to the contract.
</p>
</aside>
<h1 id='reply-methods'>Reply Methods</h1><h2 id='lighthouse-contract'>Lighthouse contract</h2>
<p>Rhombus has a pre-written contract that we can deploy to decouple your oracle
from your contract. They are fast to deploy and easily observed before
committing to integrating the data.</p>

<p>Features of a lighthouse contract</p>

<ul>
<li>One or more data items as specified</li>
<li>A nonce - incremental or returned serial number</li>
<li>Time of update written into contract</li>
<li>Optional aging data expiry mechanism</li>
<li>Optional “poke” mechanism when updated</li>
</ul>

<aside class="example">
<span class="aside-type">Example</span>
<h3>A lighthouse contract that contains hourly asset price data</h3>

<p>
A market maker wants to observe the performance of a feed before integrating.
After a month passes, they are confident in its stability, consistency, and
performance. They integrate the price data into several of their smart
contracts.
</p>

</aside>
<h2 id='direct-delivery'>Direct delivery</h2>
<blockquote>
<p><strong>Code Example</strong> <br><br>
The gold spot price must be written directly to the gold exchange contract</p>
</blockquote>
<pre class="highlight csharp tab-csharp"><code><span class="n">function</span> <span class="nf">setSpotPrice</span><span class="p">(</span><span class="kt">uint</span> <span class="n">spotPrice</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">nonce</span><span class="p">);</span>
</code></pre>
<blockquote>
<p><code>setSpotPrice</code> function signature is specified prior to delivery so the
Rhombus oracle can call it properly.</p>
</blockquote>

<p>Where the Rhombus oracle is the sole information provider, it may be more
efficient to write directly to your contract. The oracle can provide one or more
data items as well as a nonce which helps serialize replies.</p>
<h1 id='getting-started'>Getting Started</h1>
<p>Below we&#39;ll demonstrate sample integrations with both Direct and Lighthouse
delivery oracles.</p>
<h2 id='direct-delivery-2'>Direct Delivery</h2><pre class="highlight csharp tab-csharp"><code><span class="n">pragma</span> <span class="n">solidity</span> <span class="p">^</span><span class="m">0.4</span><span class="p">.</span><span class="m">24</span><span class="p">;</span>

<span class="n">import</span> <span class="s">"./rhombusClient.sol"</span><span class="p">;</span>

<span class="n">contract</span> <span class="n">FundRaiser</span> <span class="k">is</span> <span class="n">RhombusClient</span> <span class="p">{</span>

    <span class="k">struct</span> <span class="nc">Donation</span> <span class="p">{</span>
        <span class="n">address</span> <span class="n">donor</span><span class="p">;</span>
        <span class="kt">uint</span>    <span class="n">amountInUSD</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Donation</span><span class="p">[]</span> <span class="k">public</span> <span class="n">donations</span><span class="p">;</span>
    <span class="n">address</span> <span class="k">public</span> <span class="n">constant</span> <span class="n">alice</span> <span class="p">=</span>  <span class="m">0x31EFd75bc0b5fbafc6015Bd50590f4fDab6a3F22</span><span class="p">;</span>

    <span class="k">event</span> <span class="nf">Raised</span><span class="p">(</span><span class="n">address</span> <span class="n">donor</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">USDraised</span><span class="p">);</span>

    <span class="c1">// On receiving a donation (in ether), we ask the Rhombus ETH to USD oracle</span>
    <span class="c1">// to convert the amount but forward the amount to our favourite charity,</span>
    <span class="c1">// Alice's Food Kitchen.</span>

    <span class="nf">function</span> <span class="p">()</span> <span class="k">public</span> <span class="n">payable</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="k">value</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">Donation</span> <span class="n">memory</span> <span class="n">thisDonation</span><span class="p">;</span>
        <span class="n">thisDonation</span><span class="p">.</span><span class="n">donor</span> <span class="p">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">pos</span> <span class="p">=</span> <span class="n">donations</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">thisDonation</span><span class="p">);</span>
        <span class="nf">emitDoubleUint</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">pos</span><span class="p">-</span><span class="m">1</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="k">value</span><span class="p">);</span>
        <span class="n">alice</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="k">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// On receiving the USD value, the donation amount is updated and an event</span>
    <span class="c1">// emitted. This function can only be called with valid, unused nonces.</span>

    <span class="n">function</span> <span class="nf">postUSDvalue</span><span class="p">(</span><span class="kt">uint</span> <span class="n">index</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">USDvalue</span><span class="p">)</span> <span class="k">public</span> <span class="n">onlyRhombus</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">index</span> <span class="p">&lt;</span> <span class="n">donations</span><span class="p">.</span><span class="n">length</span><span class="p">,</span> <span class="s">"Invalid Index"</span><span class="p">);</span>
        <span class="n">Donation</span> <span class="n">storage</span> <span class="n">d</span> <span class="p">=</span> <span class="n">donations</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">amountInUSD</span> <span class="p">==</span> <span class="m">0</span><span class="p">,</span> <span class="s">"Record already updated"</span><span class="p">);</span>
        <span class="n">d</span><span class="p">.</span><span class="n">amountInUSD</span> <span class="p">=</span> <span class="n">USDvalue</span><span class="p">;</span>
        <span class="n">emit</span> <span class="nf">Raised</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">donor</span><span class="p">,</span> <span class="n">d</span><span class="p">.</span><span class="n">amountInUSD</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre>
<p>Alice&#39;s food kitchen has fallen on hard times so she launches a fundraiser on
the ethereum blockchain.</p>

<p>Alice want&#39;s to thank each participant for their donation not in ETH terms but
in USD terms. Rhombus, sympathetic to her needs, has agreed to provide an ETH/USD
oracle.</p>

<p>On receiving a donation, the donor&#39;s address is logged and the oracle is asked
to convert the eth value to USD. The donation is forwarded to Alice.</p>

<p>The oracle executes a direct reply to the contract&#39;s postUSDvalue function which
causes the donations log to be updated and a Raised event to be emitted which
Alice can monitor to publish a thank you note.</p>
<h2 id='lighthouse-delivery'>Lighthouse Delivery</h2><pre class="highlight csharp tab-csharp"><code><span class="n">pragma</span> <span class="n">solidity</span> <span class="p">^</span><span class="m">0.4</span><span class="p">.</span><span class="m">24</span><span class="p">;</span>

<span class="n">import</span> <span class="s">"./Ilighthouse.sol"</span><span class="p">;</span>

<span class="n">contract</span> <span class="n">TenCentsAMinute</span> <span class="p">{</span>

    <span class="n">ILighthouse</span>  <span class="k">public</span> <span class="n">myLighthouse</span><span class="p">;</span>
    <span class="nf">mapping</span><span class="p">(</span><span class="n">address</span> <span class="p">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="n">balances</span><span class="p">;</span>
    <span class="nf">mapping</span><span class="p">(</span><span class="n">address</span> <span class="p">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="n">expiry</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="n">spentFees</span><span class="p">;</span>
    <span class="n">address</span> <span class="k">public</span> <span class="n">constant</span> <span class="n">alice</span> <span class="p">=</span>  <span class="m">0x31EFd75bc0b5fbafc6015Bd50590f4fDab6a3F22</span><span class="p">;</span>

    <span class="nf">constructor</span><span class="p">(</span><span class="n">ILighthouse</span> <span class="n">_myLighthouse</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">myLighthouse</span> <span class="p">=</span> <span class="n">_myLighthouse</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nf">function</span><span class="p">()</span> <span class="k">public</span> <span class="n">payable</span> <span class="p">{</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="p">+=</span> <span class="n">msg</span><span class="p">.</span><span class="k">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="nf">buyTime</span><span class="p">(</span><span class="kt">uint</span> <span class="n">minutesToBuy</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">minutesToBuy</span> <span class="p">!=</span> <span class="m">0</span><span class="p">,</span> <span class="s">"nothing to buy"</span><span class="p">);</span>
        <span class="kt">uint</span> <span class="n">tenCentsOfETH</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">ok</span><span class="p">;</span>
        <span class="p">(</span><span class="n">tenCentsOfETH</span><span class="p">,</span><span class="n">ok</span><span class="p">)</span> <span class="p">=</span> <span class="n">myLighthouse</span><span class="p">.</span><span class="nf">peekData</span><span class="p">();</span>
        <span class="kt">uint</span> <span class="n">fee</span> <span class="p">=</span> <span class="n">tenCentsOfETH</span> <span class="p">*</span> <span class="n">minutesToBuy</span><span class="p">;</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">fee</span> <span class="p">/</span> <span class="n">minutesToBuy</span> <span class="p">==</span> <span class="n">tenCentsOfETH</span><span class="p">,</span><span class="s">"Overflow"</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">fee</span> <span class="p">&lt;</span> <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">],</span><span class="s">"Not enough funds"</span><span class="p">);</span>
        <span class="n">expiry</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="p">=</span> <span class="n">now</span> <span class="p">+</span> <span class="n">minutesToBuy</span> <span class="p">*</span> <span class="m">1</span> <span class="n">minutes</span><span class="p">;</span>
        <span class="n">spentFees</span> <span class="p">+=</span> <span class="n">fee</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="nf">inPaidTime</span><span class="p">()</span> <span class="k">public</span> <span class="n">view</span> <span class="nf">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">now</span> <span class="p">&lt;</span> <span class="n">expiry</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="nf">withdrawFees</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">alice</span> <span class="p">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="s">"Unauthorised"</span><span class="p">);</span>
        <span class="n">alice</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">spentFees</span><span class="p">);</span>
        <span class="n">spentFees</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Alice&#39;s petting zoo also operates a video feed service that allows you to watch
videos of the animals for a nominal fee of ten cents a minute.</p>

<p>Since Alice is an ethereum fan, she controls the payments using an ethereum
smart contract but that means she gets payments in ether not cents.</p>

<p>Rhombus, well known supporters of petting zoos worldwide, agree to provide a
lighthouse supplying regularly updated data for the value of ten cents in eth.</p>

<p>The contract that Alice wrote provides a function inPaidTime() that can be
called by the camera&#39;s streaming code to query whether the user has paid for
their video time.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
